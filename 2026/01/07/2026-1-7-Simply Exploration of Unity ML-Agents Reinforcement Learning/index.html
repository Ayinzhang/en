<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Simply Exploration of Unity ML-Agents Reinforcement Learning | Ayin</title><meta name="author" content="YiZhen"><meta name="copyright" content="YiZhen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="A Record of Experimenting with Unity ML-Agents">
<meta property="og:type" content="article">
<meta property="og:title" content="Simply Exploration of Unity ML-Agents Reinforcement Learning">
<meta property="og:url" content="https://ayinzhang.github.io/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/index.html">
<meta property="og:site_name" content="Ayin">
<meta property="og:description" content="A Record of Experimenting with Unity ML-Agents">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://picx.zhimg.com/v2-42d063eae19380631578c7a1af6acddd_1440w.png?source=ccfced1a">
<meta property="article:published_time" content="2026-01-06T16:00:00.000Z">
<meta property="article:modified_time" content="2026-01-18T08:53:36.272Z">
<meta property="article:author" content="YiZhen">
<meta property="article:tag" content="Artificial intelligence">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picx.zhimg.com/v2-42d063eae19380631578c7a1af6acddd_1440w.png?source=ccfced1a"><link rel="shortcut icon" href="https://fastly.jsdelivr.net/gh/ayinzhang/ayinzhang.github.io/img/icon.png"><link rel="canonical" href="https://ayinzhang.github.io/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/en/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f74029fa7cc77ea7995800ef7950497d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/en/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"EN","msgToSimplifiedChinese":"ZH"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Simply Exploration of Unity ML-Agents Reinforcement Learning',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2026-01-18 16:53:36'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/en/img/me.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">26</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/en/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="https://ayinzhang.github.io/"><i class="fa-fw fas fa-c"></i><span> Language</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picx.zhimg.com/v2-42d063eae19380631578c7a1af6acddd_1440w.png?source=ccfced1a')"><nav id="nav"><span id="blog-info"><a href="/en/" title="Ayin"><span class="site-name">Ayin</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/en/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="https://ayinzhang.github.io/"><i class="fa-fw fas fa-c"></i><span> Language</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Simply Exploration of Unity ML-Agents Reinforcement Learning</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-01-06T16:00:00.000Z" title="Created 2026-01-07 00:00:00">2026-01-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-18T08:53:36.272Z" title="Updated 2026-01-18 16:53:36">2026-01-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/en/categories/Technology-Sharing/">Technology Sharing</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/en/categories/Technology-Sharing/AI-related/">AI related</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Simply Exploration of Unity ML-Agents Reinforcement Learning"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="Written-before"><a href="#Written-before" class="headerlink" title="Written before"></a>Written before</h3><p>&emsp;&emsp;ML-Agents is Unity’s official reinforcement learning framework, using gRPC for communication between Python and Unity. It allows developers to write only C# in Unity, configure training parameters via YAML files, and train desired models. During my learning process, I found that most available materials were for outdated, incompatible versions, so I felt it necessary to document the relevant steps.</p>
<h3 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h3><h4 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h4><p>&emsp;&emsp;Referencing the <a target="_blank" rel="noopener" href="https://docs.unity3d.com/Packages/com.unity.ml-agents@4.0/manual/Installation.html">Official Documentation</a>, the ML-Agents package can be installed directly via Unity’s Package Manager. For the Python environment, Conda is recommended, especially considering the somewhat specific version requirement of Python 3.10.1-3.10.12. Next, clone the <a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/ml-agents.git">official GitHub repository</a>, and run:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install mlagents</span><br><span class="line">cd /path/to/ml-agents</span><br><span class="line">pip install ./ml-agents-envs</span><br><span class="line">pip install ./ml-agents</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;This installs the necessary libraries. It should be noted that a CUDA version of PyTorch is not strictly required for this; we’re not training large models, and using Burst can even offer better compatibility.</p>
<h4 id="General-Usage"><a href="#General-Usage" class="headerlink" title="General Usage"></a>General Usage</h4><p>&emsp;&emsp;The framework for controlling agents in Unity code generally looks like the following. <code>Heuristic()</code> is not strictly required but is commonly used for testing the environment or recording expert data, so it’s quite useful and recommended. For invoking neural network inference, you can call <code>RequestAction()</code> in the traditional <code>Update()</code> method to tick each step, or attach a <code>DecisionRequester</code> script to the agent GameObject to customize the tick frequency (e.g., every N frames). After attaching a script inheriting the agent base class, a <code>BehaviourParameters</code> component is automatically added. You then need to configure the correct input and output dimensions (number of floats) in <code>SpaceSize</code> and <code>ContinuousActions</code>.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Unity.MLAgents; <span class="comment">// Import namespace</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerAgent</span> : <span class="title">Agent</span> <span class="comment">// Inherit agent base class</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnEpisodeBegin</span>() <span class="comment">// Called at episode start (typically resets environment)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">CollectObservations</span>(<span class="params">Unity.MLAgents.Sensors.VectorSensor sensor</span>) <span class="comment">// Collect parameters for the neural network</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Heuristic</span>(<span class="params"><span class="keyword">in</span> Unity.MLAgents.Actuators.ActionBuffers actionsOut</span>) <span class="comment">// Convert keyboard/mouse input and fill output parameters</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnActionReceived</span>(<span class="params">Unity.MLAgents.Actuators.ActionBuffers actionBuffers</span>) <span class="comment">// Process parameters and apply rewards/penalties</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;For the YAML configuration, you can start by copying the official example. Modifying it requires some basic machine learning knowledge. Notably, <code>vis_encode_type</code> options include <code>simple</code>, <code>nature_cnn</code>, <code>resnet</code>, <code>match3</code> (specialized for match-3 games), and <code>fully_connected</code>. Among these, <code>simple</code> uses a 20x20 convolutional kernel, <code>nature_cnn</code> uses 36x36, <code>resnet</code> uses 15x15, and <code>match3</code> uses 5x5. The input dimensions must not be smaller than the kernel size.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">behaviors:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">trainer_type:</span> <span class="string">ppo</span></span><br><span class="line">    <span class="attr">hyperparameters:</span></span><br><span class="line">      <span class="attr">batch_size:</span> <span class="number">64</span></span><br><span class="line">      <span class="attr">buffer_size:</span> <span class="number">12000</span></span><br><span class="line">      <span class="attr">learning_rate:</span> <span class="number">0.005</span></span><br><span class="line">      <span class="attr">beta:</span> <span class="number">0.001</span></span><br><span class="line">      <span class="attr">epsilon:</span> <span class="number">0.2</span></span><br><span class="line">      <span class="attr">lambd:</span> <span class="number">0.99</span></span><br><span class="line">      <span class="attr">num_epoch:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">learning_rate_schedule:</span> <span class="string">linear</span></span><br><span class="line">    <span class="attr">network_settings:</span></span><br><span class="line">      <span class="attr">normalize:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">hidden_units:</span> <span class="number">128</span></span><br><span class="line">      <span class="attr">num_layers:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">vis_encode_type:</span> <span class="string">simple</span></span><br><span class="line">    <span class="attr">reward_signals:</span></span><br><span class="line">      <span class="attr">extrinsic:</span></span><br><span class="line">        <span class="attr">gamma:</span> <span class="number">0.99</span></span><br><span class="line">        <span class="attr">strength:</span> <span class="number">1.0</span></span><br><span class="line">    <span class="attr">keep_checkpoints:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">max_steps:</span> <span class="number">500000</span></span><br><span class="line">    <span class="attr">time_horizon:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">summary_freq:</span> <span class="number">12000</span></span><br></pre></td></tr></table></figure>

<h3 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h3><p>&emsp;&emsp;Recently, I came across an introduction to the ghost behavior patterns in Pac-Man and was once again amazed by the clever design of classic FC&#x2F;NES games. I thought it would be interesting to recreate and train this.</p>
<table>
<thead>
<tr>
<th>Ghost Name</th>
<th>Color</th>
<th>Behavior Pattern</th>
<th>Core Strategy &amp; Target</th>
</tr>
</thead>
<tbody><tr>
<td>Blinky</td>
<td>Red</td>
<td>Chaser</td>
<td>Always aims directly at Pac-Man’s current position for straight pursuit.</td>
</tr>
<tr>
<td>Pinky</td>
<td>Pink</td>
<td>Ambusher</td>
<td>Targets a position 4 tiles ahead of Pac-Man for interception and ambush.</td>
</tr>
<tr>
<td>Inky</td>
<td>Blue</td>
<td>Opportunist</td>
<td>Targets the mirrored point between Blinky and a position 2 tiles ahead of Pac-Man. Often attacks from the flank or rear.</td>
</tr>
<tr>
<td>Clyde</td>
<td>Orange</td>
<td>Fickle</td>
<td>Directly chases Pac-Man when distance &gt; 8 tiles. Otherwise, moves toward its fixed corner.</td>
</tr>
</tbody></table>
<p>&emsp;&emsp;A strictly faithful recreation would be too time-consuming. Considering this, I decided to directly create a 21*27 grid map, discretizing the continuous space. This avoids the need for asset creation and greatly simplifies movement and collision logic.</p>
<h4 id="OnEpisodeBegin"><a href="#OnEpisodeBegin" class="headerlink" title="OnEpisodeBegin()"></a>OnEpisodeBegin()</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnEpisodeBegin</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    manager.ResetMap();</span><br><span class="line">    <span class="keyword">var</span> enemyObjs = <span class="keyword">new</span> GameObject[] &#123; manager.blinky, manager.pinky, manager.inky, manager.clyde &#125;;</span><br><span class="line">    <span class="comment">// Fisher-Yates shuffle. Typically, multiple prefabs are created in the Scene for training together, which is why position modifications are local.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">3</span>; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> randIndex = Random.Range(<span class="number">0</span>, i + <span class="number">1</span>);</span><br><span class="line">        Vector2Int temp = enemyPos[i];</span><br><span class="line">        enemyPos[i] = enemyPos[randIndex];</span><br><span class="line">        enemyPos[randIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        Enemy enemy = enemyObjs[i].GetComponent&lt;Enemy&gt;(); enemys.Add(enemy); enemy.curPos = enemyPos[i];</span><br><span class="line">        enemy.transform.localPosition = <span class="keyword">new</span> Vector3(<span class="number">0.5f</span> * (<span class="number">-21</span> / <span class="number">2</span> + enemy.curPos.x), <span class="number">0.5f</span> * (<span class="number">-27</span> / <span class="number">2</span> + enemy.curPos.y), <span class="number">0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CollectObservations"><a href="#CollectObservations" class="headerlink" title="CollectObservations()"></a>CollectObservations()</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">CollectObservations</span>(<span class="params">Unity.MLAgents.Sensors.VectorSensor sensor</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Pass player and enemy positions</span></span><br><span class="line">    sensor.AddObservation(curPos);</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) sensor.AddObservation(enemys[i].curPos);</span><br><span class="line">    <span class="comment">// Double compression: state compression to save space (200+ input parameters are too large), scaling to 0f-1f to avoid gradient vanishing/explosion (8-bit compression to prevent overly small numerical changes)</span></span><br><span class="line">    <span class="built_in">int</span> groupCount = <span class="number">28</span>, dotsPerGroup = <span class="number">8</span>; <span class="comment">// 224/8=28</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> <span class="keyword">group</span> = <span class="number">0</span>; <span class="keyword">group</span> &lt; groupCount; <span class="keyword">group</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uint</span> bitMask = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dotsPerGroup; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> dotIndex = <span class="keyword">group</span> * dotsPerGroup + i;</span><br><span class="line">            <span class="keyword">if</span> (dots[dotIndex]) bitMask |= (<span class="number">1u</span> &lt;&lt; i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">float</span> encodedValue = bitMask / <span class="number">65535.0f</span>;</span><br><span class="line">        sensor.AddObservation(encodedValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Heuristic"><a href="#Heuristic" class="headerlink" title="Heuristic()"></a>Heuristic()</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Heuristic</span>(<span class="params"><span class="keyword">in</span> ActionBuffers actionsOut</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> discreteActionsOut = actionsOut.DiscreteActions;</span><br><span class="line">    discreteActionsOut[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (Input.GetKey(KeyCode.W)) discreteActionsOut[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (Input.GetKey(KeyCode.S)) discreteActionsOut[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (Input.GetKey(KeyCode.A)) discreteActionsOut[<span class="number">0</span>] = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (Input.GetKey(KeyCode.D)) discreteActionsOut[<span class="number">0</span>] = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OnActionReceived"><a href="#OnActionReceived" class="headerlink" title="OnActionReceived()"></a>OnActionReceived()</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnActionReceived</span>(<span class="params">ActionBuffers actionsOut</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    steps++; moveAction = actionsOut.DiscreteActions[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    Vector2Int moveDir = Vector2Int.zero;</span><br><span class="line">    <span class="keyword">switch</span> (moveAction)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: moveDir = Vector2Int.up; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: moveDir = Vector2Int.down; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: moveDir = Vector2Int.left; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: moveDir = Vector2Int.right; <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (moveDir == Vector2Int.zero) <span class="keyword">return</span>;</span><br><span class="line">    curDir = moveDir;</span><br><span class="line"></span><br><span class="line">    Vector2Int tarPos = curPos + moveDir;</span><br><span class="line">    tarPos.x = (tarPos.x + MAP_WIDTH) % MAP_WIDTH;</span><br><span class="line">    tarPos.y = (tarPos.y + MAP_HEIGHT) % MAP_HEIGHT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (manager.mapData[tarPos.x, tarPos.y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">// dot</span></span><br><span class="line">            manager.mapData[tarPos.x, tarPos.y] = <span class="number">2</span>;</span><br><span class="line">            manager.spriteRenders[tarPos.x + MAP_WIDTH * tarPos.y].transform.localScale = Vector3.zero;</span><br><span class="line">            curPos = tarPos;</span><br><span class="line">            transform.localPosition = <span class="keyword">new</span> Vector3(<span class="number">0.5f</span> * (-MAP_WIDTH / <span class="number">2</span> + curPos.x), <span class="number">0.5f</span> * (-MAP_HEIGHT / <span class="number">2</span> + curPos.y), <span class="number">0f</span>);</span><br><span class="line">            AddReward(++dotsEaten / <span class="number">214f</span>);</span><br><span class="line">            <span class="comment">// Area reward and completion reward</span></span><br><span class="line">            <span class="keyword">if</span> (dotsEaten == <span class="number">214</span>) EndPacmanEpisode(<span class="number">10f</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (curPos.x * <span class="number">2</span> + <span class="number">1</span> &lt; MAP_WIDTH &amp;&amp; curPos.y * <span class="number">2</span> + <span class="number">1</span> &lt; MAP_HEIGHT) AddReward(--dl == <span class="number">0</span> ? <span class="number">5</span> : dl == <span class="number">5</span> ? <span class="number">2</span> : dl == <span class="number">10</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (curPos.x * <span class="number">2</span> + <span class="number">1</span> &gt; MAP_WIDTH &amp;&amp; curPos.y * <span class="number">2</span> + <span class="number">1</span> &lt; MAP_HEIGHT) AddReward(--dr == <span class="number">0</span> ? <span class="number">5</span> : dr == <span class="number">5</span> ? <span class="number">2</span> : dr == <span class="number">10</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (curPos.x * <span class="number">2</span> + <span class="number">1</span> &lt; MAP_WIDTH &amp;&amp; curPos.y * <span class="number">2</span> + <span class="number">1</span> &gt; MAP_HEIGHT) AddReward(--ul == <span class="number">0</span> ? <span class="number">5</span> : ul == <span class="number">5</span> ? <span class="number">2</span> : ul == <span class="number">10</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (curPos.x * <span class="number">2</span> + <span class="number">1</span> &gt; MAP_WIDTH &amp;&amp; curPos.y * <span class="number">2</span> + <span class="number">1</span> &gt; MAP_HEIGHT) AddReward(--ur == <span class="number">0</span> ? <span class="number">5</span> : ur == <span class="number">5</span> ? <span class="number">2</span> : ur == <span class="number">10</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// wall</span></span><br><span class="line">            wallsHit++;</span><br><span class="line">            AddReward(<span class="number">-0.01f</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// empty</span></span><br><span class="line">            curPos = tarPos;</span><br><span class="line">            transform.localPosition = <span class="keyword">new</span> Vector3(<span class="number">0.5f</span> * (-MAP_WIDTH / <span class="number">2</span> + curPos.x), <span class="number">0.5f</span> * (-MAP_HEIGHT / <span class="number">2</span> + curPos.y), <span class="number">0f</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Ghost speed increases with the number of dots eaten</span></span><br><span class="line">    <span class="keyword">if</span> (++tmp &gt; dotsEaten / <span class="number">100</span> + <span class="number">1</span>) tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; enemys.Count; i++) enemys[i].Tick();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> minGhostDist = <span class="number">114514</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; enemys.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> aid = curPos.x + curPos.y * MAP_WIDTH, bid = enemys[i].curPos.x + enemys[i].curPos.y * MAP_WIDTH;</span><br><span class="line">        <span class="keyword">if</span> (!dis.TryGetValue(<span class="keyword">new</span> Vector2Int(aid, bid), <span class="keyword">out</span> <span class="built_in">int</span> dist)) dist = <span class="number">114514</span>;</span><br><span class="line">        <span class="keyword">if</span> (dist == <span class="number">0</span>) EndPacmanEpisode();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (dist &lt; minGhostDist) minGhostDist = dist;</span><br><span class="line">    &#125;</span><br><span class="line">    AddReward(<span class="number">-0.01f</span> * Mathf.Max(<span class="number">0</span>, <span class="number">3</span> - minGhostDist));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="EndPacmanEpisode"><a href="#EndPacmanEpisode" class="headerlink" title="EndPacmanEpisode()"></a>EndPacmanEpisode()</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EndPacmanEpisode</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Since reward values do not directly represent the number of dots eaten, add statistics for dots eaten and wall hit rate</span></span><br><span class="line">    <span class="keyword">var</span> statsRecorder = Academy.Instance.StatsRecorder; </span><br><span class="line">    statsRecorder.Add(<span class="string">&quot;Pacman/DotsEaten&quot;</span>, dotsEaten);</span><br><span class="line">    statsRecorder.Add(<span class="string">&quot;Pacman/WallHitRate&quot;</span>, (<span class="built_in">float</span>)wallsHit / steps);</span><br><span class="line">    EndEpisode();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PacmanVisualSensor-cs"><a href="#PacmanVisualSensor-cs" class="headerlink" title="PacmanVisualSensor.cs"></a>PacmanVisualSensor.cs</h4><p>&emsp;&emsp;Here, I passed information about walls, dots, enemies, and the player as an image to the agent network, requiring an additional script.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Unity.MLAgents.Sensors;</span><br><span class="line"><span class="keyword">using</span> Unity.MLAgents.Sensors.Reflection;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line">[<span class="meta">RequireComponent(typeof(PlayerAgent))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PacmanVisualSensor</span> : <span class="title">SensorComponent</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> PlayerAgent agent;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> width = <span class="number">21</span>, height = <span class="number">27</span>, channels = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (agent == <span class="literal">null</span>) agent = GetComponent&lt;PlayerAgent&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> ISensor[] <span class="title">CreateSensors</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ISensor[] &#123; <span class="keyword">new</span> InternalPacmanSensor(agent, width, height, channels) &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title">InternalPacmanSensor</span> : <span class="title">ISensor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> PlayerAgent agent;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">int</span> width, height, channels;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InternalPacmanSensor</span>(<span class="params">PlayerAgent agent, <span class="built_in">int</span> width, <span class="built_in">int</span> height, <span class="built_in">int</span> channels</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.agent = agent;</span><br><span class="line">            <span class="keyword">this</span>.width = width;</span><br><span class="line">            <span class="keyword">this</span>.height = height;</span><br><span class="line">            <span class="keyword">this</span>.channels = channels;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span>[] <span class="title">GetObservationShape</span>()</span> =&gt; <span class="keyword">new</span> <span class="built_in">int</span>[] &#123; channels, height, width &#125;;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> ObservationSpec <span class="title">GetObservationSpec</span>()</span> =&gt; ObservationSpec.Visual(channels, height, width);</span><br><span class="line">        <span class="function"><span class="keyword">public</span> CompressionSpec <span class="title">GetCompressionSpec</span>()</span> =&gt; CompressionSpec.Default();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetName</span>()</span> =&gt; <span class="string">&quot;PacmanVisualSensor&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">byte</span>[] <span class="title">GetCompressedObservation</span>()</span> =&gt; <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>()</span> &#123; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Write</span>(<span class="params">ObservationWriter writer</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (agent.manager == <span class="literal">null</span> || agent.enemys == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Safe initialization, set all to 0</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> c = <span class="number">0</span>; c &lt; channels; c++)</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; height; y++)</span><br><span class="line">                        <span class="keyword">for</span> (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; width; x++)</span><br><span class="line">                            writer[c, y, x] = <span class="number">0f</span>;</span><br><span class="line">                <span class="keyword">return</span> width * height * channels;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; height; y++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> mapY = Mathf.Clamp(y * PlayerAgent.MAP_HEIGHT / height, <span class="number">0</span>, PlayerAgent.MAP_HEIGHT - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; width; x++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">int</span> mapX = Mathf.Clamp(x * PlayerAgent.MAP_WIDTH / width, <span class="number">0</span>, PlayerAgent.MAP_WIDTH - <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">// Channel 0: Walls</span></span><br><span class="line">                    writer[<span class="number">0</span>, y, x] = agent.manager.mapData[mapX, mapY] == <span class="number">1</span> ? <span class="number">1f</span> : <span class="number">0f</span>;</span><br><span class="line">                    <span class="comment">// Channel 1: Dots</span></span><br><span class="line">                    writer[<span class="number">1</span>, y, x] = agent.manager.mapData[mapX, mapY] == <span class="number">0</span> ? <span class="number">1f</span> : <span class="number">0f</span>;</span><br><span class="line">                    <span class="comment">// Channels 2-5: Four independent ghost channels (Key modification)</span></span><br><span class="line">                    writer[<span class="number">2</span>, y, x] = <span class="number">0f</span>; writer[<span class="number">3</span>, y, x] = <span class="number">0f</span>;</span><br><span class="line">                    writer[<span class="number">4</span>, y, x] = <span class="number">0f</span>;  writer[<span class="number">5</span>, y, x] = <span class="number">0f</span>;</span><br><span class="line">                    <span class="comment">// Iterate through the ghost list to check if any ghost is at the current (mapX, mapY)</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; agent.enemys.Count; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">var</span> e = agent.enemys[i];</span><br><span class="line">                        <span class="keyword">if</span> (e.curPos.x == mapX &amp;&amp; e.curPos.y == mapY) writer[<span class="number">2</span> + i, y, x] = <span class="number">1f</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Channel 6: Player itself</span></span><br><span class="line">                    writer[<span class="number">6</span>, y, x] = (agent.curPos.x == mapX &amp;&amp; agent.curPos.y == mapY) ? <span class="number">1f</span> : <span class="number">0f</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> width * height * channels;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Verification"><a href="#Verification" class="headerlink" title="Verification"></a>Verification</h3><p>&emsp;&emsp;After slightly adjusting parameters (network architecture, steps, learning rate, hidden layers, hidden units), I trained for 15M epochs. The following is a segment captured during training. For this minimalist Pac-Man, it performs reasonably well. Visualization during training is even an optimizable aspect…</p>
<p><img src="https://pic1.zhimg.com/80/v2-06d9f01d7eada256734d3c0bda274a78_1440w.gif?source=ccfced1a" alt="img"></p>
<p>&emsp;&emsp;The results are roughly as follows: Initially using state-compressed dot representation + fully connected architecture, convergence reached ~90 dots; later using image perception + match3 architecture, convergence reached ~180 dots; finally, adding area rewards, convergence reached 200+ dots, finally able to complete the game.</p>
<p><img src="https://picx.zhimg.com/80/v2-056779392648caa468e4fd4178ddc2d2_1440w.png?source=ccfced1a" alt="img"></p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>&emsp;&emsp;I view the product of reinforcement learning as a complex state machine that can make characters in games more intelligent in many situations. However, debugging relies heavily on intuition, trial and error, and experience… Truly like alchemy, and I’m joining now(</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://ayinzhang.github.io/en">YiZhen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://ayinzhang.github.io/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/">https://ayinzhang.github.io/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/en/tags/Artificial-intelligence/">Artificial intelligence</a></div><div class="post_share"><div class="social-share" data-image="https://picx.zhimg.com/v2-42d063eae19380631578c7a1af6acddd_1440w.png?source=ccfced1a" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>Sponsor</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/en/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/en/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/en/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/en/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/" title="Analysis of Godot Physics Source Code"><img class="cover" src="https://picx.zhimg.com/v2-a58a4e744580865dce7d671dfb7ebbb3_1440w.png?source=ccfced1a" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">Analysis of Godot Physics Source Code</div></div></a></div><div class="next-post pull-right"><a href="/en/2025/12/19/2025-12-19-Simply%20Exploration%20of%20LLM%20PEFT%20Fine-tuning%20and%20Ollama%20Operation/" title="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation"><img class="cover" src="https://pic1.zhimg.com/v2-71b0fc16e8b2f0e3771e38494b646666_r.jpg?source=172ae18b" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/en/2025/12/19/2025-12-19-Simply%20Exploration%20of%20LLM%20PEFT%20Fine-tuning%20and%20Ollama%20Operation/" title="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation"><img class="cover" src="https://pic1.zhimg.com/v2-71b0fc16e8b2f0e3771e38494b646666_r.jpg?source=172ae18b" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-19</div><div class="title">Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/en/img/me.jpg" onerror="this.onerror=null;this.src='/en/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">YiZhen</div><div class="author-info__description">End Apocalypse</div></div><div class="card-info-data site-data is-center"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">26</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ayinzhang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ayinzhang" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1242857339@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">It's just a little wind frost</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Written-before"><span class="toc-number">1.</span> <span class="toc-text">Written before</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Preparation"><span class="toc-number">2.</span> <span class="toc-text">Preparation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Resources"><span class="toc-number">2.1.</span> <span class="toc-text">Resources</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#General-Usage"><span class="toc-number">2.2.</span> <span class="toc-text">General Usage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Advanced"><span class="toc-number">3.</span> <span class="toc-text">Advanced</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OnEpisodeBegin"><span class="toc-number">3.1.</span> <span class="toc-text">OnEpisodeBegin()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CollectObservations"><span class="toc-number">3.2.</span> <span class="toc-text">CollectObservations()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Heuristic"><span class="toc-number">3.3.</span> <span class="toc-text">Heuristic()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OnActionReceived"><span class="toc-number">3.4.</span> <span class="toc-text">OnActionReceived()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EndPacmanEpisode"><span class="toc-number">3.5.</span> <span class="toc-text">EndPacmanEpisode()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PacmanVisualSensor-cs"><span class="toc-number">3.6.</span> <span class="toc-text">PacmanVisualSensor.cs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Verification"><span class="toc-number">4.</span> <span class="toc-text">Verification</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary"><span class="toc-number">5.</span> <span class="toc-text">Summary</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/en/2026/01/17/2026-1-17-Godot%20Jolt%20Parallel%20Comparison/" title="Godot vs Jolt Parallel Comparison"><img src="https://picx.zhimg.com/v2-d28e53e000188ec10622ace95af2cfcb_1440w.png?source=ccfced1a" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Godot vs Jolt Parallel Comparison"/></a><div class="content"><a class="title" href="/en/2026/01/17/2026-1-17-Godot%20Jolt%20Parallel%20Comparison/" title="Godot vs Jolt Parallel Comparison">Godot vs Jolt Parallel Comparison</a><time datetime="2026-01-16T16:00:00.000Z" title="Created 2026-01-17 00:00:00">2026-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/" title="Analysis of Godot Physics Source Code"><img src="https://picx.zhimg.com/v2-a58a4e744580865dce7d671dfb7ebbb3_1440w.png?source=ccfced1a" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Analysis of Godot Physics Source Code"/></a><div class="content"><a class="title" href="/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/" title="Analysis of Godot Physics Source Code">Analysis of Godot Physics Source Code</a><time datetime="2026-01-14T16:00:00.000Z" title="Created 2026-01-15 00:00:00">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/" title="Simply Exploration of Unity ML-Agents Reinforcement Learning"><img src="https://picx.zhimg.com/v2-42d063eae19380631578c7a1af6acddd_1440w.png?source=ccfced1a" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Simply Exploration of Unity ML-Agents Reinforcement Learning"/></a><div class="content"><a class="title" href="/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/" title="Simply Exploration of Unity ML-Agents Reinforcement Learning">Simply Exploration of Unity ML-Agents Reinforcement Learning</a><time datetime="2026-01-06T16:00:00.000Z" title="Created 2026-01-07 00:00:00">2026-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2025/12/19/2025-12-19-Simply%20Exploration%20of%20LLM%20PEFT%20Fine-tuning%20and%20Ollama%20Operation/" title="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation"><img src="https://pic1.zhimg.com/v2-71b0fc16e8b2f0e3771e38494b646666_r.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation"/></a><div class="content"><a class="title" href="/en/2025/12/19/2025-12-19-Simply%20Exploration%20of%20LLM%20PEFT%20Fine-tuning%20and%20Ollama%20Operation/" title="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation">Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation</a><time datetime="2025-12-18T16:00:00.000Z" title="Created 2025-12-19 00:00:00">2025-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2025/08/16/2025-8-16-Simply%20Exploration%20of%20Unity%20YooAsset%20+%20HybridCLR%20Hot%20Update/" title="Simply Exploration of Unity YooAsset + HybridCLR Hot Update"><img src="https://pic1.zhimg.com/v2-09bfa8f60abc5361104c7584f6df43cd_720w.jpeg?source=d16d100b" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Simply Exploration of Unity YooAsset + HybridCLR Hot Update"/></a><div class="content"><a class="title" href="/en/2025/08/16/2025-8-16-Simply%20Exploration%20of%20Unity%20YooAsset%20+%20HybridCLR%20Hot%20Update/" title="Simply Exploration of Unity YooAsset + HybridCLR Hot Update">Simply Exploration of Unity YooAsset + HybridCLR Hot Update</a><time datetime="2025-08-15T16:00:00.000Z" title="Created 2025-08-16 00:00:00">2025-08-16</time></div></div></div></div></div></div></main><footer id="footer" style="background: rgba(1,1,1,0)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2026 By YiZhen</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="translateLink" type="button" title="Toggle Between Chinese And English">EN</button><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/en/js/utils.js?v=4.13.0"></script><script src="/en/js/main.js?v=4.13.0"></script><script src="/en/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{
  const getGiscusTheme = theme => {
    return theme === 'dark' ? 'dark' : 'light'
  }

  const loadGiscus = () => {
    const config = Object.assign({
      src: 'https://giscus.app/client.js',
      'data-repo': 'ayinzhang/ayinzhang.github.io',
      'data-repo-id': 'R_kgDOKl3Dog',
      'data-category-id': 'DIC_kwDOKl3Dos4CaqXe',
      'data-mapping': 'pathname',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true
    },null)

    const ele = document.createElement('script')
    for (let key in config) {
      ele.setAttribute(key, config[key])
    }
    document.getElementById('giscus-wrap').appendChild(ele)
  }

  const changeGiscusTheme = theme => {
    const sendMessage = message => {
      const iframe = document.querySelector('iframe.giscus-frame')
      if (!iframe) return
      iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
    }

    sendMessage({
      setConfig: {
        theme: getGiscusTheme(theme)
      }
    });
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment= loadGiscus
  }
})()</script></div><script data-pjax src="/en/self/btf.js"></script><script data-pjax src="/en/self/tw_en.js"></script><div class="aplayer no-destroy" data-id="8985244058" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script id="canvas_nest" defer="defer" color="0,0,0" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="true" data-text="且行且看,尽力而为,不要害怕,不要后悔" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/en/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/en/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/en/live2dw/assets/elica.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":20,"vOffset":-130},"mobile":{"show":false,"scale":0.3},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body></html>