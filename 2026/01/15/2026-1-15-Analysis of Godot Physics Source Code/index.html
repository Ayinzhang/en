<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Analysis of Godot Physics Source Code | Ayin</title><meta name="author" content="YiZhen"><meta name="copyright" content="YiZhen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Engine source code analysis">
<meta property="og:type" content="article">
<meta property="og:title" content="Analysis of Godot Physics Source Code">
<meta property="og:url" content="https://ayinzhang.github.io/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/index.html">
<meta property="og:site_name" content="Ayin">
<meta property="og:description" content="Engine source code analysis">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://picx.zhimg.com/v2-a58a4e744580865dce7d671dfb7ebbb3_1440w.png?source=ccfced1a">
<meta property="article:published_time" content="2026-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2026-01-18T09:30:32.126Z">
<meta property="article:author" content="YiZhen">
<meta property="article:tag" content="Engine Tools">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picx.zhimg.com/v2-a58a4e744580865dce7d671dfb7ebbb3_1440w.png?source=ccfced1a"><link rel="shortcut icon" href="https://fastly.jsdelivr.net/gh/ayinzhang/ayinzhang.github.io/img/icon.png"><link rel="canonical" href="https://ayinzhang.github.io/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/en/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f74029fa7cc77ea7995800ef7950497d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/en/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"EN","msgToSimplifiedChinese":"ZH"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Analysis of Godot Physics Source Code',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2026-01-18 17:30:32'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/en/img/me.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">26</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/en/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="https://ayinzhang.github.io/"><i class="fa-fw fas fa-c"></i><span> Language</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picx.zhimg.com/v2-a58a4e744580865dce7d671dfb7ebbb3_1440w.png?source=ccfced1a')"><nav id="nav"><span id="blog-info"><a href="/en/" title="Ayin"><span class="site-name">Ayin</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/en/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/en/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/en/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/en/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/en/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/en/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="https://ayinzhang.github.io/"><i class="fa-fw fas fa-c"></i><span> Language</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Analysis of Godot Physics Source Code</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-01-14T16:00:00.000Z" title="Created 2026-01-15 00:00:00">2026-01-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-18T09:30:32.126Z" title="Updated 2026-01-18 17:30:32">2026-01-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/en/categories/Technology-Sharing/">Technology Sharing</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/en/categories/Technology-Sharing/Engine-Related/">Engine-Related</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Analysis of Godot Physics Source Code"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="Written-before"><a href="#Written-before" class="headerlink" title="Written before"></a>Written before</h3><p>&emsp;&emsp;Reading engine source code is fundamental for engine development roles, and those who know me are aware that I focus on physics simulation. During an internship at a project team, I had modified Unity’s source code, but back at school, I can only access open-source engines. UE’s Chaos is somewhat heavy: during initialization, the Scene sequentially creates Scene, Solver, Evolution, and Objects sequentially register events, create states, and initialize bodies; during simulation, AOS data from the game thread is pushed to the SOA physics thread, undergoes a series of complex calculations (considering my focus on mobile performance), and then dirty modified data is pulled back. In contrast, Godot’s source code is lightweight and well-structured, making it suitable for dissecting the 3D physics portion.</p>
<p>&emsp;&emsp;Reviewing the latest Godot 4.5 documentation is actually quite interesting. For example, Godot’s memory management: small objects use heap allocation with reserved free memory, while large objects use a dynamic memory pool (recorded using PooledList for lists and freelists). This differs significantly from the OS’s paging choices, highlighting the difference between specialization and generality? Also, Godot’s 2021 article explaining why it doesn’t use an ECS architecture and its choice of abstraction levels (offering a new perspective, though I personally don’t entirely agree, but since it’s open source, one can build their own framework if needed). Furthermore, Godot’s mobile rendering pipeline cannot read adjacent pixels (Seriously? This disables fragment derivatives, and compute shaders are largely unsupported. Even phones in India and Southeast Asia aren’t this fragile, are they?).</p>
<h3 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h3><p>&emsp;&emsp;The entire 3D physics portion of Godot resides in <code>modules/godot_physics_3d</code>, making it exceptionally convenient to locate.</p>
<ul>
<li><strong>Physics Server</strong> (<code>godot_physics_server_3d</code>) creates and manages spaces, shapes, areas, and collision objects.</li>
<li><strong>Physics Space</strong> (<code>godot_space_3d</code>) contains all objects in the physics world and is responsible for physics simulation.</li>
<li><strong>Physics Stepper</strong> (<code>godot_step_3d</code>) is used by the space to step through the physics simulation.</li>
<li><strong>Collision Detection</strong> (<code>godot_broad_phase_3d</code>) quickly identifies potential colliding object pairs.</li>
<li><strong>Collision Solver</strong> (<code>godot_collision_solver_3d</code>) handles specific collision detection between shapes.</li>
<li><strong>Shapes</strong> (<code>godot_shape_3d</code>) define various geometric shapes used for collision detection.</li>
<li><strong>Collision Objects</strong> (<code>godot_collision_object_3d</code>) are the base classes for Areas, RigidBodies, and SoftBodies, all of which can have shapes.</li>
<li><strong>Areas</strong> (<code>godot_area_3d</code>) detect object entry and exit and can modify properties like gravity.</li>
<li><strong>Rigid Bodies</strong> (<code>godot_body_3d</code>) are hard physical objects affected by forces and collisions.</li>
<li><strong>Soft Bodies</strong> (<code>godot_soft_body_3d</code>) are deformable objects simulated using a particle system.</li>
<li><strong>Constraints and Joints</strong> (<code>godot_constraint_3d</code> and <code>godot_joint_3d</code>) restrict motion between objects.</li>
</ul>
<p>&emsp;&emsp;The simulation flow is roughly as follows:</p>
<p><img src="https://pica.zhimg.com/80/v2-74734bd1b082f910e28b3ceb32019426_1440w.png?source=ccfced1a" alt="img"></p>
<h3 id="Parameter-Preparation"><a href="#Parameter-Preparation" class="headerlink" title="Parameter Preparation"></a>Parameter Preparation</h3><p>&emsp;&emsp;First, let’s start with preparation. Although it involves handling various property settings, the main processing lies in updating the object’s mass properties. Taking the most complex RigidBody as an example, it first calculates the total area (summing the area of each shape), then calculates the center of mass (distributing mass proportionally by area), and finally calculates the inertia tensor (parallel axis theorem).</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GodotBody3D::update_mass_properties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Select the calculation path based on the mode type</span></span><br><span class="line">    <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">        <span class="keyword">case</span> PhysicsServer3D::BODY_MODE_RIGID: &#123;</span><br><span class="line">            <span class="comment">// Rigid body - Complete calculation of mass properties</span></span><br><span class="line">            <span class="comment">// Area - Mass Center - Inertia</span></span><br><span class="line">        &#125; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> PhysicsServer3D::BODY_MODE_KINEMATIC:</span><br><span class="line">        <span class="keyword">case</span> PhysicsServer3D::BODY_MODE_STATIC: &#123;</span><br><span class="line">            <span class="comment">// Kinematics/Static Body - No Mass Attribute</span></span><br><span class="line">        &#125; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> PhysicsServer3D::BODY_MODE_RIGID_LINEAR: &#123;</span><br><span class="line">            <span class="comment">// Linear rigid body - Mass only, no rotational inertia</span></span><br><span class="line">        &#125; <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Update the quality attributes of the dependency transformation</span></span><br><span class="line">    _update_transform_dependent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;Let’s briefly supplement the calculation of the inertia tensor:$I_{total} &#x3D; \displaystyle\sum_{i&#x3D;1}^{n}{(R I_{local}R^T + w(r \cdot r \cdot I_{identity} - r \otimes r))} $。Bounded by the plus sign, the left side is the current shape’s moment of inertia, and the right side is the weighted composition. This might be abstract, so let’s illustrate with the inertia tensor of a point cloud.</p>
<p>&emsp;&emsp;Assume we have a spinning top composed of n points, where the coordinates of point i are pi, the mass of point i is mi, and we wish to calculate its initial rotational inertia. Then the formula is:$I_{ref}&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}(m_i(r_i\cdot r_i\cdot I_{identity}− r_i\otimes r_i))$，, where the offset vector $r_i&#x3D;p_i-p_{center}$. This is the right part of the formula used by the engine, where the dot product describes mass distribution, and the outer product describes inertia contribution. Then the top starts spinning with rotation matrix $R$, giving $ I&#x3D;RI_{ref}R^T $. This is the left part of the formula. Combining them yields the scheme used by the engine (here, the engine’s method accounts for the positional offset of the shape within the overall inertia tensor, which I personally find unnecessary).</p>
<h3 id="Integrating-Forces"><a href="#Integrating-Forces" class="headerlink" title="Integrating  Forces"></a>Integrating  Forces</h3><p>&emsp;&emsp;After updating the physical properties, the next steps are integrating external forces for rigid bodies, shape prediction for soft bodies, and BVH collision detection.</p>
<h4 id="Integrating-Forces-for-Rigid-Bodies"><a href="#Integrating-Forces-for-Rigid-Bodies" class="headerlink" title="Integrating Forces for Rigid Bodies"></a>Integrating Forces for Rigid Bodies</h4><p>&emsp;&emsp;First is integrating forces for rigid bodies. Skipping the code that iterates through areas to determine damping modes, we go directly to the core part. For kinematic objects, they are externally driven, and their linear and angular velocities are updated based on position and rotation changes. For rigid bodies, they first calculate the net force and net torque, then apply damping to update velocity.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GodotBody3D::integrate_forces</span><span class="params">(<span class="type">real_t</span> p_step)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mode == PhysicsServer3D::BODY_MODE_STATIC) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get current gravity and damping </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (mode == PhysicsServer3D::BODY_MODE_KINEMATIC) &#123;</span><br><span class="line">		<span class="comment">//compute velocities from prev transfor</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//compute force and torque</span></span><br><span class="line">                <span class="comment">//apply damp and update velocity</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//If CCD is used, calculate the motion for this step.</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//If motion is calculated, update the shape for ray cast.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Shape-Prediction-for-Soft-Bodies"><a href="#Shape-Prediction-for-Soft-Bodies" class="headerlink" title="Shape Prediction for Soft Bodies"></a>Shape Prediction for Soft Bodies</h4><p>&emsp;&emsp;Next is shape prediction for soft bodies. Similarly, skipping the code that iterates through areas to determine gravity, after calculating wind forces, the integration uses explicit Euler plus displacement clamping, and finally updates bounds and acceleration structures (AABB bounding box tree). (The soft bodies don’t even use semi-implicit Euler, but the subsequent iterative correction for soft bodies should suffice.)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GodotSoftBody3D::predict_motion</span><span class="params">(<span class="type">real_t</span> p_delta)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Apply gravity and wind forces.</span></span><br><span class="line">	<span class="comment">// Explicit euler + displacement clamping</span></span><br><span class="line">	<span class="comment">// Update AABB bounds tree(vertices and triangular faces).</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BVH-Collision-Detection"><a href="#BVH-Collision-Detection" class="headerlink" title="BVH Collision Detection"></a>BVH Collision Detection</h4><p>&emsp;&emsp;Finally, BVH collision detection: first update the BVH tree, then detect collisions. Updating the BVH tree involves incremental optimization and dynamic expansion. The collision detection phase first expands AABBs, then fills clipping parameters, identifies items no longer colliding, queries overlapping items, and processes new collisions.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GodotBroadPhase3DBVH::update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Update BVH tree</span></span><br><span class="line">        <span class="comment">// Check collisions</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;Starting with Godot’s implementation of a dynamic BVH tree based on a template library, node and leaf definitions are as follows.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TNode</span> &#123;</span><br><span class="line">    BVHABB_CLASS aabb;</span><br><span class="line">    <span class="keyword">union</span> &#123; <span class="type">int32_t</span> num_children, neg_leaf_id; &#125;;</span><br><span class="line">    <span class="type">uint32_t</span> parent_id;</span><br><span class="line">    <span class="type">uint16_t</span> children[MAX_CHILDREN];</span><br><span class="line">    <span class="type">int32_t</span> height;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TLeaf</span> &#123;</span><br><span class="line">    <span class="type">uint16_t</span> num_items, dirty;</span><br><span class="line">    <span class="type">uint32_t</span> item_ref_ids[MAX_ITEMS];      <span class="comment">// Array of item reference IDs</span></span><br><span class="line">    BVHABB_CLASS aabbs[MAX_ITEMS];         <span class="comment">// Array of item AABB</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;In incremental optimization, it starts from the bottom-up to update AABB bounding boxes based on the existing structure, then extracts a node per frame to update and reinsert it, thus solving AABB inflation and suboptimal placement.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">incremental_optimize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Traverse downwards to the leaf nodes.</span></span><br><span class="line">	<span class="comment">// Check for dirty marks, if necessary do upward fit.</span></span><br><span class="line">        <span class="built_in">refit_branch</span>(root);</span><br><span class="line">        <span class="comment">// Remove and get AABB</span></span><br><span class="line">        <span class="comment">// Reinsert and balanced the path</span></span><br><span class="line">        _logic_item_remove_and_reinsert(node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Constraint-Grouping"><a href="#Constraint-Grouping" class="headerlink" title="Constraint Grouping"></a>Constraint Grouping</h3><h4 id="Constructing-Constraints"><a href="#Constructing-Constraints" class="headerlink" title="Constructing Constraints"></a>Constructing Constraints</h4><p>&emsp;&emsp;After integrating external forces, the next step is constructing constraint relationships for subsequent parallelization. Godot divides this into three different logics for Areas, RigidBodies, and SoftBodies. Simply put, the Area part just throws any associated object in (since no computation is performed). RigidBodies detect associated RigidBodies and SoftBodies. SoftBodies only detect associated RigidBodies (SoftBody-to-SoftBody collisions are presumably not supported yet). The logic for constructing constraints in these three parts is largely similar; here, we show the RigidBody’s as a simple example.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> _populate_island(GodotBody3D *p_body, ...) &#123;</span><br><span class="line">        <span class="comment">// 1. Iterate through all the constraints of the rigid body</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> KeyValue&lt;GodotConstraint3D *, <span class="type">int</span>&gt; &amp;E : p_body-&gt;<span class="built_in">get_constraint_map</span>()) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. Search for the connected rigid body</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; constraint-&gt;<span class="built_in">get_body_count</span>(); i++) &#123;</span><br><span class="line">            GodotBody3D *other_body = constraint-&gt;<span class="built_in">get_body_ptr</span>()[i];</span><br><span class="line">            <span class="keyword">if</span> (i == E.value) <span class="keyword">continue</span>;  <span class="comment">// Skip self</span></span><br><span class="line">            _populate_island(other_body, ...);  <span class="comment">// Recursive detection</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. Search for the connected soft body</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; constraint-&gt;<span class="built_in">get_soft_body_count</span>(); i++) &#123;</span><br><span class="line">            GodotSoftBody3D *soft_body = constraint-&gt;<span class="built_in">get_soft_body_ptr</span>(i);</span><br><span class="line">            _populate_island_soft_body(soft_body, ...);  <span class="comment">// Turn to softbody</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Solving-Constraints"><a href="#Solving-Constraints" class="headerlink" title="Solving Constraints"></a>Solving Constraints</h4><p>&emsp;&emsp;After constructing constraints, the next step is solving them: first, set up all constraints in parallel, then pre-solve on a single thread (filtering invalid constraints), and finally solve in parallel (using prioritized iterations). Specific constraints are implemented by inherited classes like area, body, joint. Here, we analyze the more generic body (area has no solving step, and joints have too many variants).</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">GodotBodyPair3D::setup</span><span class="params">(<span class="type">real_t</span> p_step)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// 1. Check exception layers and collision layers</span></span><br><span class="line">         <span class="comment">// 2. Calculate offset</span></span><br><span class="line">         <span class="comment">// 3. Detect collisions</span></span><br><span class="line">         <span class="comment">// 4. Mark whether CCD is required</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">GodotBodyPair3D::pre_solve</span><span class="params">(<span class="type">real_t</span> p_step)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// 1. If CCD is required, call _test_ccd()</span></span><br><span class="line">         <span class="comment">// 2. Calculate the quality, offset, and impulse of the contact point</span></span><br><span class="line">         <span class="comment">// 3. Report the contact point</span></span><br><span class="line">         <span class="comment">// 4. Calculate the rebound coefficient</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GodotBodyPair3D::solve</span><span class="params">(<span class="type">real_t</span> p_step)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// 1. Solving for the offset impulse (for penetration resolution)</span></span><br><span class="line">         <span class="comment">// 2. Solving for the normal impulse (for collision resolution)</span></span><br><span class="line">         <span class="comment">// 3. Solving for the tangential impulse (for friction resolution)</span></span><br><span class="line">         <span class="comment">// 4. Accumulating and limiting the impulses</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;It’s worth noting that its 3D collision detection is a port of the GJK-EPA algorithm from the Bullet physics engine, a standard in game engines. However, I’m curious why no engine implements SAT. This O(n) algorithm with a small constant might be better than O(log n) with a large constant for simple shapes like OBBs, especially within 100 items. The reason might be that Godot needs EPA to calculate depth for penetration impulses, but I personally dislike the non-physical concept of penetration impulses. I guess I’ll have to write my own physics engine to play with it someday.</p>
<h3 id="Integrating-Velocities"><a href="#Integrating-Velocities" class="headerlink" title="Integrating Velocities"></a>Integrating Velocities</h3><h4 id="Integrating-Velocities-1"><a href="#Integrating-Velocities-1" class="headerlink" title="Integrating Velocities"></a>Integrating Velocities</h4><p>&emsp;&emsp;After solving constraints, the next step is integrating velocities. For rigid bodies, this essentially involves various callback registrations, handling object properties, and updating positions with axis locking.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GodotBody3D::integrate_velocities</span><span class="params">(<span class="type">real_t</span> p_step)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// 1. Callback registration</span></span><br><span class="line">         <span class="comment">// 2. Kinematic objects, axis locking processing</span></span><br><span class="line">         <span class="comment">// 3. Transformation update</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Constraint-Solving"><a href="#Constraint-Solving" class="headerlink" title="Constraint Solving"></a>Constraint Solving</h4><p>&emsp;&emsp;For soft bodies, the final output stage is slightly more complex, involving iterative constraint solving (essentially based on PBD distance constraints but with XPBD-like stiffness scaling and mass weighting).</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GodotSoftBody3D::solve_constraints</span><span class="params">(<span class="type">real_t</span> p_delta)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// 1. Pre-compute link parameters</span></span><br><span class="line">         <span class="comment">// 2. Predict position (using current speed)</span></span><br><span class="line">         <span class="comment">// 3. Iteratively solve constraints (position correction)</span></span><br><span class="line">         <span class="comment">// 4. Update physical properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;Let’s briefly expand on constraint solving. It first calculates compliance $c_0 &#x3D; (invMass0 + invMass1) &#x2F; stiffness$, then solves with $k &#x3D; (L² − |x|²) &#x2F; (c0 ∗ (L² + |x|²))$. The first step combines mass and stiffness but does not divide by $Δt²$ to decouple material properties from simulation timestep. The second step uses $(L² + |x|²) $in the denominator for numerical stability but does not store and accumulate Lagrange multiplier λ, so it’s only a modified PBD.</p>
<p>&emsp;&emsp;But then again, in games, timestep and iteration counts are constant; as long as stiffness is adjustable, it’s fine. Not to mention the 5%-10% performance cost from XPBD, XPBD is also burdened by the large constant $Δt²$, making parameter adjustment non-intuitive. For artists, tweaking parameters to extreme values only yields subtle differences. In such cases, XPBD becomes a technical trap (since I handle programming, design, and art).</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>&emsp;&emsp;Godot’s 3D physics engine is a lightweight, modular real-time physics simulation system. Through constraint partitioning and parallel solving, it can also run efficiently on multi-core CPUs. Although reading source code is inherently troublesome, it’s far less mentally taxing than UE. I hope this analysis provides some help to readers.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://ayinzhang.github.io/en">YiZhen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://ayinzhang.github.io/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/">https://ayinzhang.github.io/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/en/tags/Engine-Tools/">Engine Tools</a></div><div class="post_share"><div class="social-share" data-image="https://picx.zhimg.com/v2-a58a4e744580865dce7d671dfb7ebbb3_1440w.png?source=ccfced1a" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>Sponsor</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/en/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/en/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/en/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/en/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/en/2026/01/17/2026-1-17-Godot%20Jolt%20Parallel%20Comparison/" title="Godot vs Jolt Parallel Comparison"><img class="cover" src="https://picx.zhimg.com/v2-d28e53e000188ec10622ace95af2cfcb_1440w.png?source=ccfced1a" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">Godot vs Jolt Parallel Comparison</div></div></a></div><div class="next-post pull-right"><a href="/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/" title="Simply Exploration of Unity ML-Agents Reinforcement Learning"><img class="cover" src="https://picx.zhimg.com/v2-42d063eae19380631578c7a1af6acddd_1440w.png?source=ccfced1a" onerror="onerror=null;src='/en/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">Simply Exploration of Unity ML-Agents Reinforcement Learning</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/en/2026/01/17/2026-1-17-Godot%20Jolt%20Parallel%20Comparison/" title="Godot vs Jolt Parallel Comparison"><img class="cover" src="https://picx.zhimg.com/v2-d28e53e000188ec10622ace95af2cfcb_1440w.png?source=ccfced1a" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-17</div><div class="title">Godot vs Jolt Parallel Comparison</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/en/img/me.jpg" onerror="this.onerror=null;this.src='/en/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">YiZhen</div><div class="author-info__description">End Apocalypse</div></div><div class="card-info-data site-data is-center"><a href="/en/archives/"><div class="headline">Articles</div><div class="length-num">26</div></a><a href="/en/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a><a href="/en/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ayinzhang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ayinzhang" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1242857339@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">It's just a little wind frost</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Written-before"><span class="toc-number">1.</span> <span class="toc-text">Written before</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Architecture-Overview"><span class="toc-number">2.</span> <span class="toc-text">Architecture Overview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Parameter-Preparation"><span class="toc-number">3.</span> <span class="toc-text">Parameter Preparation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Integrating-Forces"><span class="toc-number">4.</span> <span class="toc-text">Integrating  Forces</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Integrating-Forces-for-Rigid-Bodies"><span class="toc-number">4.1.</span> <span class="toc-text">Integrating Forces for Rigid Bodies</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shape-Prediction-for-Soft-Bodies"><span class="toc-number">4.2.</span> <span class="toc-text">Shape Prediction for Soft Bodies</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BVH-Collision-Detection"><span class="toc-number">4.3.</span> <span class="toc-text">BVH Collision Detection</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Constraint-Grouping"><span class="toc-number">5.</span> <span class="toc-text">Constraint Grouping</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Constructing-Constraints"><span class="toc-number">5.1.</span> <span class="toc-text">Constructing Constraints</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Solving-Constraints"><span class="toc-number">5.2.</span> <span class="toc-text">Solving Constraints</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Integrating-Velocities"><span class="toc-number">6.</span> <span class="toc-text">Integrating Velocities</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Integrating-Velocities-1"><span class="toc-number">6.1.</span> <span class="toc-text">Integrating Velocities</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Constraint-Solving"><span class="toc-number">6.2.</span> <span class="toc-text">Constraint Solving</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-number"></span> <span class="toc-text">Summary</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/en/2026/01/17/2026-1-17-Godot%20Jolt%20Parallel%20Comparison/" title="Godot vs Jolt Parallel Comparison"><img src="https://picx.zhimg.com/v2-d28e53e000188ec10622ace95af2cfcb_1440w.png?source=ccfced1a" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Godot vs Jolt Parallel Comparison"/></a><div class="content"><a class="title" href="/en/2026/01/17/2026-1-17-Godot%20Jolt%20Parallel%20Comparison/" title="Godot vs Jolt Parallel Comparison">Godot vs Jolt Parallel Comparison</a><time datetime="2026-01-16T16:00:00.000Z" title="Created 2026-01-17 00:00:00">2026-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/" title="Analysis of Godot Physics Source Code"><img src="https://picx.zhimg.com/v2-a58a4e744580865dce7d671dfb7ebbb3_1440w.png?source=ccfced1a" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Analysis of Godot Physics Source Code"/></a><div class="content"><a class="title" href="/en/2026/01/15/2026-1-15-Analysis%20of%20Godot%20Physics%20Source%20Code/" title="Analysis of Godot Physics Source Code">Analysis of Godot Physics Source Code</a><time datetime="2026-01-14T16:00:00.000Z" title="Created 2026-01-15 00:00:00">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/" title="Simply Exploration of Unity ML-Agents Reinforcement Learning"><img src="https://picx.zhimg.com/v2-42d063eae19380631578c7a1af6acddd_1440w.png?source=ccfced1a" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Simply Exploration of Unity ML-Agents Reinforcement Learning"/></a><div class="content"><a class="title" href="/en/2026/01/07/2026-1-7-Simply%20Exploration%20of%20Unity%20ML-Agents%20Reinforcement%20Learning/" title="Simply Exploration of Unity ML-Agents Reinforcement Learning">Simply Exploration of Unity ML-Agents Reinforcement Learning</a><time datetime="2026-01-06T16:00:00.000Z" title="Created 2026-01-07 00:00:00">2026-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2025/12/19/2025-12-19-Simply%20Exploration%20of%20LLM%20PEFT%20Fine-tuning%20and%20Ollama%20Operation/" title="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation"><img src="https://pic1.zhimg.com/v2-71b0fc16e8b2f0e3771e38494b646666_r.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation"/></a><div class="content"><a class="title" href="/en/2025/12/19/2025-12-19-Simply%20Exploration%20of%20LLM%20PEFT%20Fine-tuning%20and%20Ollama%20Operation/" title="Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation">Simply Exploration of LLM PEFT Fine-tuning and Ollama Operation</a><time datetime="2025-12-18T16:00:00.000Z" title="Created 2025-12-19 00:00:00">2025-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/en/2025/08/16/2025-8-16-Simply%20Exploration%20of%20Unity%20YooAsset%20+%20HybridCLR%20Hot%20Update/" title="Simply Exploration of Unity YooAsset + HybridCLR Hot Update"><img src="https://pic1.zhimg.com/v2-09bfa8f60abc5361104c7584f6df43cd_720w.jpeg?source=d16d100b" onerror="this.onerror=null;this.src='/en/img/404.jpg'" alt="Simply Exploration of Unity YooAsset + HybridCLR Hot Update"/></a><div class="content"><a class="title" href="/en/2025/08/16/2025-8-16-Simply%20Exploration%20of%20Unity%20YooAsset%20+%20HybridCLR%20Hot%20Update/" title="Simply Exploration of Unity YooAsset + HybridCLR Hot Update">Simply Exploration of Unity YooAsset + HybridCLR Hot Update</a><time datetime="2025-08-15T16:00:00.000Z" title="Created 2025-08-16 00:00:00">2025-08-16</time></div></div></div></div></div></div></main><footer id="footer" style="background: rgba(1,1,1,0)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2026 By YiZhen</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="translateLink" type="button" title="Toggle Between Chinese And English">EN</button><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/en/js/utils.js?v=4.13.0"></script><script src="/en/js/main.js?v=4.13.0"></script><script src="/en/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{
  const getGiscusTheme = theme => {
    return theme === 'dark' ? 'dark' : 'light'
  }

  const loadGiscus = () => {
    const config = Object.assign({
      src: 'https://giscus.app/client.js',
      'data-repo': 'ayinzhang/ayinzhang.github.io',
      'data-repo-id': 'R_kgDOKl3Dog',
      'data-category-id': 'DIC_kwDOKl3Dos4CaqXe',
      'data-mapping': 'pathname',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true
    },null)

    const ele = document.createElement('script')
    for (let key in config) {
      ele.setAttribute(key, config[key])
    }
    document.getElementById('giscus-wrap').appendChild(ele)
  }

  const changeGiscusTheme = theme => {
    const sendMessage = message => {
      const iframe = document.querySelector('iframe.giscus-frame')
      if (!iframe) return
      iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
    }

    sendMessage({
      setConfig: {
        theme: getGiscusTheme(theme)
      }
    });
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment= loadGiscus
  }
})()</script></div><script data-pjax src="/en/self/btf.js"></script><script data-pjax src="/en/self/tw_en.js"></script><div class="aplayer no-destroy" data-id="8985244058" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script id="canvas_nest" defer="defer" color="0,0,0" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="true" data-text="且行且看,尽力而为,不要害怕,不要后悔" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/en/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/en/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/en/live2dw/assets/elica.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":20,"vOffset":-130},"mobile":{"show":false,"scale":0.3},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body></html>